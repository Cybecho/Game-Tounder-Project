# 🎮 게임 시스템 상세 문서

이 문서는 게임을 구성하는 핵심 시스템들의 설계 철학과 구체적인 구현 방식을 상세히 설명합니다.

## ⚡ 대쉬 시스템 (Instant-Teleport Dash System)

### 설계 철학
단순한 속도 증가가 아닌, **완벽한 순간이동**을 구현하여 플레이어에게 극적인 회피 수단과 조작의 재미를 제공하는 것을 목표로 했습니다. 대쉬는 단순한 이동기를 넘어, 생존과 공격을 위한 핵심 전략 요소로 설계되었습니다.

### 핵심 구현: `performDash()`
1.  **즉시 위치 변경:** `this.player.setPosition()`을 사용하여 계산된 목표 지점으로 플레이어를 즉시 이동시킵니다. 점진적인 움직임이 전혀 없어 '순간이동'의 느낌을 극대화합니다.
2.  **물리 상태 리셋:** 이동 후 `this.player.setVelocity(0, 0)`를 호출하여 기존의 관성을 완전히 제거하고, 대쉬 후의 움직임이 예측 가능하도록 만듭니다.
3.  **무적 상태:** 대쉬가 진행되는 짧은 시간 동안 플레이어는 무적(`isDashing = true`)이 되어, 적과의 충돌을 무시하고 공격적으로 파고들거나 위험 지역을 탈출할 수 있습니다.

### 시각적 피드백 시스템
- **번개 이펙트 (`createInstantLightningEffect`):** 대쉬 경로를 따라 두꺼운 사이언 색상의 번개와 흰색 외곽선이 그려져, 빠르고 강력한 에너지가 방출되는 느낌을 시각적으로 전달합니다.
- **잔상 효과 (`createInstantDashTrail`):** 이동 경로에 8개의 반투명한 플레이어 잔상을 남겨, 순간적인 움직임의 궤적을 시각적으로 인지할 수 있도록 돕습니다.
- **카메라 효과:** 화면이 미세하게 흔들리고(`shake`), 흰색으로 번쩍이는(`flash`) 효과를 통해 대쉬의 폭발적인 느낌을 강화합니다.

### 3중 차지 및 개별 쿨다운 시스템
- **독립적 쿨다운:** 3개의 대쉬 차지는 각각 4초의 독립적인 쿨다운을 가집니다. 이는 한 번에 모든 대쉬를 사용한 후 오랜 시간 무방비 상태가 되는 것을 방지하고, 지속적인 전략 활용을 가능하게 합니다.
- **UI 동기화:** `updateDashCooldowns` 메서드가 100ms마다 각 차지의 쿨다운을 계산하고, 사용 가능 횟수와 쿨다운 진행률을 UI에 정확하게 시각화합니다.

## 💥 물리 기반 넉백 시스템 (Physics-Based Knockback)

### 설계 철학
단순히 적을 뒤로 미는 것이 아니라, **현실적인 물리 법칙**에 기반한 넉백을 구현하여 전투에 깊이와 예측 불가능성을 더했습니다. 적들이 서로 부딪히고, 연쇄적으로 튕겨나가는 모습은 시각적 재미와 함께 새로운 전략적 변수를 창출합니다.

### 구현 방식
1.  **충격량 계산:** 총알과 적이 충돌하는 순간(`hitEnemy`), 총알의 방향과 속도를 기반으로 초기 충격량(`knockbackForce`)을 계산합니다. 엘리트 몬스터는 일반 몬스터보다 넉백 저항이 높게 설정됩니다.
2.  **초기 벡터 적용:** 계산된 충격량을 적의 `knockbackX`, `knockbackY` 프로퍼티에 저장합니다.
3.  **마찰 기반 감속:** `moveEnemies` 메서드에서 매 프레임마다 넉백 벡터에 0.92의 마찰 계수를 곱하여, 마치 얼음판 위의 바둑알처럼 자연스럽게 미끄러지다가 멈추는 효과를 구현합니다. 속도가 거의 0에 가까워지면 벡터를 0으로 초기화하여 불필요한 연산을 방지합니다.

## 👹 적 AI 및 스폰 시스템

### 계층적 AI 행동 패턴
- **기본 추적:** 모든 적은 기본적으로 플레이어를 향해 이동합니다.
- **워블링(Wobbling):** 예측 가능한 직선 이동을 피하기 위해, `Math.sin` 함수를 이용한 약간의 좌우 흔들림(워블링)을 추가하여 회피를 더 어렵게 만듭니다. 엘리트 몬스터는 워블링의 폭과 주기가 달라 더 위협적인 움직임을 보입니다.
- **물리 반응:** 자신의 의지와 상관없이 넉백 시스템에 의해 밀려나는 물리적 상호작용이 최우선으로 처리됩니다.

### 엘리트 몬스터 시스템
- **차별화된 속성:** 일반 적보다 50배 높은 체력, 거대한 충돌 박스, 그리고 전용 체력바를 가집니다.
- **전용 UI:** `createEliteHealthBar` 함수는 엘리트 몬스터의 머리 위에 항상 따라다니는 체력바를 생성하여, 플레이어가 명확한 목표를 인지하고 집중 공격하도록 유도합니다.
- **시각적 강조:** 지속적으로 반짝이는 트윈 애니메이션을 통해 다른 적들 사이에서도 눈에 띄게 만듭니다.

## 🔮 아이템 시스템

### 도망가는 AI
- **설계 의도:** 아이템 획득을 단순한 수집이 아닌, 하나의 **미니 게임**처럼 만들기 위해 설계되었습니다. 이는 플레이어에게 위험을 감수하고 아이템을 쫓을 것인지, 아니면 포기할 것인지 선택하는 전략적 딜레마를 제공합니다.
- **구현:** 탄환 업그레이드 아이템(`bullet_upgrade`)은 200픽셀의 감지 범위(`detectionRange`)를 가집니다. 플레이어가 이 범위 안에 들어오면, 플레이어의 반대 방향으로 `fleeSpeed`(150)의 속도로 도망갑니다. 범위 밖에 있을 때는 느린 속도로 무작위 배회를 합니다.

### 희소성 기반 스폰
- 탄환 업그레이드 아이템은 15초마다 스폰 기회를 가지지만, **30%의 확률**을 통과해야만 실제로 생성됩니다. 이러한 희소성은 아이템의 가치를 높이고 획득의 성취감을 증대시킵니다.

## 📈 동적 난이도 시스템

### 다차원적 난이도 증가
게임의 난이도는 단순히 시간이 흐른다고 증가하는 것이 아니라, `difficultyLevel`이라는 변수를 통해 여러 요소가 복합적으로 조절됩니다.

- **스폰 속도 증가:** 20초마다 `enemySpawnRate`가 80ms씩 감소하여(최소 400ms), 적들이 점점 더 빽빽하게 등장합니다.
- **웨이브 규모 증가:** `enemiesPerWave`가 점차 증가하여(최대 4), 한 번에 나타나는 적의 수가 늘어납니다.
- **적 능력치 강화:** `baseEnemySpeed`가 증가하여 모든 적들의 기본 이동 속도가 점차 빨라집니다.

이 시스템은 플레이어가 게임에 익숙해지는 속도에 맞춰 자연스럽게 도전 과제를 높여, 게임의 긴장감을 끝까지 유지시키는 역할을 합니다.
